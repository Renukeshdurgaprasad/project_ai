<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Assistant</title>
    <script>
        async function chat() {
            let userInput = document.getElementById("chatInput").value;
            if (!userInput.trim()) {
                alert("Please enter a message!");
                return;
            }

            try {
                let response = await fetch("http://127.0.0.1:5000/chat_multi", {  // Fixed API URL
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ message: userInput })
                });

                let data = await response.json();
                document.getElementById("chatResponse").innerText = data.response;
                fetchHistory();  // Update history after chat
            } catch (error) {
                console.error("Error in chat:", error);
                alert("Failed to connect to the server. Make sure the backend is running!");
            }
        }
        async function toggleHistory() {
        let history = document.getElementById("historyContainer");
        let button = document.querySelector(".history-toggle");
        if (history.style.display === "block") {
            history.style.display = "none";
            button.textContent = "History";
        } else {
            history.style.display = "block";
            button.textContent = "Close History";
        }
    }

        async function fetchHistory() {
            try {
                let response = await fetch("http://127.0.0.1:5000/history");  // Fixed API URL
                let data = await response.json();
                let historyList = document.getElementById("historyList");
                historyList.innerHTML = "";

                if (data.length === 0) {
                    historyList.innerHTML = "<li>No history available.</li>";
                    return;
                }

                data.forEach(item => {
                    let li = document.createElement("li");
                    li.innerText = item.input + " â†’ " + item.response;
                    historyList.appendChild(li);
                });
            } catch (error) {
                console.error("Error fetching history:", error);
                alert("Failed to fetch history. Check if the backend is running.");
            }
        }
        async function deleteHistory(id) {
            try {
                let response = await fetch(`http://127.0.0.1:5000/history/${id}`, {
                    method: "DELETE"
                });
                if (response.ok) {
                    fetchHistory();  // Refresh history after deletion
                } else {
                    alert("Failed to delete history item.");
                }
            } catch (error) {
                console.error("Error deleting history:", error);
                alert("Failed to delete history item.");
            }
        }
    </script>
     <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
    
        /* Center Align Chatbot Section */
        .chat-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 80%;
            max-width: 800px;
            margin-top: 20px;
            text-align: center;
        }
    
        h2 {
            color: #333;
            font-size: 24px;
        }
    
        /* History Toggle Button */
        .history-toggle {
            position: fixed;
            left: 10px;
            top: 10px;
            background: #0084ff;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            border: none;
            transition: background 0.3s;
        }
        .history-toggle:hover {
            background: #0056b3;
        }
    
        /* Chat History (Initially Hidden) */
        .history-container {
            position: fixed;
            left: 10px;
            top: 50px;
            width: 280px;
            height: 80vh;
            background-color: #2c2c2c;
            color: white;
            padding: 10px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            display: none; /* Initially hidden */
            border-radius: 5px;
        }
        .history-container h2 {
            font-size: 18px;
            margin-bottom: 10px;
            text-align: center;
        }
        #historyList {
            list-style-type: none;
            padding: 0;
        }
        #historyList li {
            background: #444;
            margin: 5px 0;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }
    
        /* Input Box at Bottom */
        .input-container {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            justify-content: center;
            align-items: center;
            width: 70%;
            max-width: 700px;
            background: white;
            padding: 10px;
            border-radius: 25px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
        }
    
        #chatInput {
            width: 100%;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
        }
        .chat-button {
            margin-left: 10px;
            padding: 15px 20px;
            background-color: #0084ff;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        .chat-button:hover {
            background-color: #0056b3;
        }
    
        /* Chat Response Styling */
        .response-container {
            width: 60%;
            max-width: 700px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-top: 10px;
            text-align: left;
        }
    
    </style>
    </head>
<body onload="fetchHistory()">
    <button class="history-toggle" onclick="toggleHistory()">History</button>
    <div class="history-container" id="historyContainer">
        <h2>Chat History</h2>
        <ul id="historyList"></ul>
    </div>
    <div class="chat-container">
        <h2>AI Agent</h2>
        <div class="response-container">
            <p id="chatResponse"></p>
            <ul id="historyList"></ul>
        </div>
    </div>
    <div class="input-container">
        <input type="text" id="chatInput" placeholder="Ask something...">
        <button class="chat-button" onclick="chat()">Chat</button>
    </div>
    

    
</body>
</html>
